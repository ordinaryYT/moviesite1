<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ogmovie</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:#000;color:#fff;font-family:Arial,sans-serif}
  header{text-align:center;padding:2rem;position:relative}
  h1{color:#e50914;font-size:2.5rem}
  #adminBtn{position:absolute;top:2rem;right:2rem;background:#e50914;color:white;border:none;padding:0.5rem 1rem;border-radius:4px;cursor:pointer;font-weight:bold}
  #searchContainer{max-width:500px;margin:0 auto 1rem auto;padding:0 2rem}
  #searchInput{width:100%;padding:1rem;border-radius:8px;border:2px solid #333;background:#1a1a1a;color:#fff;font-size:1.1rem}
  #searchInput:focus{outline:none;border-color:#e50914}

  .filter-tabs{display:flex;justify-content:center;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}
  .filter-tab{padding:0.5rem 1rem;background:#1a1a1a;border-radius:6px;cursor:pointer;transition:.3s;font-weight:bold}
  .filter-tab.active{background:#e50914}

  .section{margin-bottom:3rem}
  .section h2{margin-bottom:1rem;color:#e50914;padding:0 2rem}
  #movieGrid, .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1.5rem;padding:0 2rem;max-width:1400px;margin:0 auto}

  .movie-card{
    position:relative;border-radius:12px;overflow:hidden;background:#1a1a1a;
    transition:.3s;cursor:pointer;
  }
  .movie-card:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(229,9,20,.5)}
  .movie-card img{width:100%;height:300px;object-fit:cover}

  .info-bar{
    padding:0.6rem 0.8rem;background:rgba(0,0,0,0.9);backdrop-filter:blur(4px);
  }
  .info-bar h3{
    font-size:0.95rem;line-height:1.3;margin-bottom:0.3rem;color:#fff;
    display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;
    overflow:hidden;
  }
  .info-bar .year{
    font-size:0.8rem;color:#aaa;margin-bottom:0.5rem;
  }

  .btn-bar{
    display:flex;gap:0.5rem;justify-content:space-between;
    padding:0 0.6rem 0.6rem;
  }
  .btn-bar button{
    flex:1;background:#333;color:#fff;border:none;padding:0.5rem 0;
    border-radius:6px;font-size:0.85rem;cursor:pointer;transition:.2s;
    font-weight:bold;
  }
  .btn-bar button:hover{background:#e50914}
  .btn-bar .fav-btn{
    background:none;color:#fff;font-size:1.3rem;
  }
  .btn-bar .fav-btn.active{color:#e50914}

  .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:1000;align-items:center;justify-content:center}
  .modal.active{display:flex}
  .modal-content{background:#1a1a1a;padding:2rem;border-radius:12px;width:90%;max-width:400px;position:relative}
  .close-modal{position:absolute;top:10px;right:15px;background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer}
  .modal h2{margin-bottom:1.5rem;color:#e50914}
  .form-group{margin-bottom:1rem}
  .form-group label{display:block;margin-bottom:0.5rem;color:#ccc}
  .form-group input,.form-group select{width:100%;padding:0.75rem;border-radius:4px;border:1px solid #333;background:#333;color:#fff}
  .modal-btn{width:100%;padding:0.75rem;background:#e50914;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:bold;margin-top:1rem}

  #adminPanel{display:none;padding:2rem;max-width:1400px;margin:0 auto}
  #adminPanel.active{display:block}
  .admin-actions{margin-bottom:2rem;display:flex;gap:1rem;flex-wrap:wrap}
  .admin-btn{padding:0.75rem 1.5rem;background:#e50914;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:bold}
  .movie-list-admin{margin-top:2rem}
  .movie-item-admin{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#1a1a1a;margin-bottom:1rem;border-radius:8px}
  .movie-item-admin button{background:#ff4444;color:white;border:none;padding:0.5rem 1rem;border-radius:4px;cursor:pointer}

  .player-container{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:999}
  .player-container.active{display:block}
  .close-btn{position:absolute;top:10px;right:10px;background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer;z-index:1001}
  .player-wrapper{position:relative;width:100%;height:100%}
  #playerIframe{width:100%;height:100%;border:none}
  .iframe-overlay{position:absolute;top:5px;left:0;width:160px;height:55px;background:#000;z-index:3;display:flex;align-items:center;justify-content:center;font-weight:bold;color:rgba(255,255,255,.5);letter-spacing:2px;text-transform:uppercase;border-radius:8px;}
  .bottom-left-overlay{position:absolute;bottom:10px;left:200px;width:120px;height:40px;background:#000;z-index:10;border-radius:8px;}
</style>
</head>
<body>
<header>
  <h1>ogmovie</h1>
  <button id="adminBtn">Admin</button>
</header>
<main>
  <div id="searchContainer">
    <input type="text" id="searchInput" placeholder="Search any movie or TV show..." />
  </div>

  <div class="filter-tabs">
    <div class="filter-tab active" data-filter="all">All</div>
    <div class="filter-tab" data-filter="movie">Movies</div>
    <div class="filter-tab" data-filter="tv_show">TV Shows</div>
    <div class="filter-tab" data-filter="favorites">Favorites</div>
  </div>

  <section id="allSection"><div id="allGrid" class="grid"></div></section>
  <section id="movieSection" style="display:none"><div id="movieGrid" class="grid"></div></section>
  <section id="tvSection" style="display:none"><div id="tvGrid" class="grid"></div></section>
  <section id="favoritesSection" style="display:none"><div id="favoritesGrid" class="grid"></div></section>

  <div id="adminPanel" class="admin-panel">
    <div class="admin-actions">
      <button class="admin-btn" onclick="openAddMovieModal()">Add Content</button>
      <button class="admin-btn" onclick="openGlobalPasswordModal()">Add Global Password</button>
      <button class="admin-btn" onclick="loadAdminMovies()">Refresh List</button>
    </div>
    <div id="movieListAdmin" class="movie-list-admin"></div>
    <div id="globalPasswordList" style="margin-top:2rem"></div>
  </div>
</main>

<!-- MODALS (unchanged) -->
<div id="loginModal" class="modal">...</div>
<div id="addMovieModal" class="modal">...</div>
<div id="passwordModal" class="modal">...</div>
<div id="globalPasswordModal" class="modal">...</div>
<div id="episodeModal" class="modal">...</div>

<!-- Trailer Modal -->
<div id="trailerModal" class="modal">
  <div class="modal-content" style="width:90%;max-width:800px;height:80vh">
    <button class="close-modal" onclick="closeTrailer()">x</button>
    <iframe id="trailerIframe" style="width:100%;height:100%;border:none" allowfullscreen></iframe>
  </div>
</div>

<div id="playerContainer" class="player-container">
  <button class="close-btn" onclick="closePlayer()">X</button>
  <div class="player-wrapper">
    <iframe id="playerIframe" allowfullscreen allow="autoplay; fullscreen" referrerpolicy="no-referrer"></iframe>
    <div class="iframe-overlay">ogmovie</div>
    <div class="bottom-left-overlay"></div>
  </div>
</div>

<script>
const API = window.location.origin + '/api';
const allGrid = document.getElementById('allGrid');
const movieGrid = document.getElementById('movieGrid');
const tvGrid = document.getElementById('tvGrid');
const favoritesGrid = document.getElementById('favoritesGrid');
const searchInput = document.getElementById('searchInput');
const filterTabs = document.querySelectorAll('.filter-tab');
const trailerModal = document.getElementById('trailerModal');
const trailerIframe = document.getElementById('trailerIframe');

let allMovies = [], movies = [], tvShows = [], favorites = [];
let currentFilter = 'all';
let clientId = localStorage.getItem('clientId') || crypto.randomUUID();
if (!localStorage.getItem('clientId')) localStorage.setItem('clientId', clientId);

async function getMoviePoster(title, year = '') {
  try {
    const res = await fetch(`https://api.tvmaze.com/search/shows?q=${encodeURIComponent(title)}`);
    const data = await res.json();
    if (data[0]?.show?.image?.medium) return data[0].show.image.medium;
  } catch {}
  return `https://via.placeholder.com/300x450/333/fff?text=${encodeURIComponent(title.slice(0,15))}`;
}

function createMovieCard(movie) {
  const card = document.createElement('div');
  card.className = 'movie-card';
  card.innerHTML = `
    <img src="" alt="${movie.title}" loading="lazy">
    <div class="info-bar">
      <h3>${movie.title}</h3>
      <div class="year">${movie.year || 'N/A'}</div>
    </div>
    <div class="btn-bar">
      <button class="trailer-btn" data-id="${movie.id}">Trailer</button>
      <button class="play-btn" data-id="${movie.id}">Play</button>
      <button class="fav-btn" data-id="${movie.id}">${favorites.includes(movie.id) ? 'Heart' : 'Heart'}</button>
    </div>
  `;

  getMoviePoster(movie.title, movie.year).then(src => {
    card.querySelector('img').src = src;
  });

  const trailerBtn = card.querySelector('.trailer-btn');
  const playBtn = card.querySelector('.play-btn');
  const favBtn = card.querySelector('.fav-btn');

  trailerBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    playTrailer(movie.id);
  });

  playBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    requestMoviePassword(movie.id, movie.title, movie.type);
  });

  favBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleFavorite(movie.id, favBtn);
  });

  return card;
}

function renderSection(list, grid) {
  grid.innerHTML = '';
  if (list.length === 0) {
    grid.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#aaa">No content</p>';
    return;
  }
  list.forEach(m => grid.appendChild(createMovieCard(m)));
}

function renderCurrent() {
  const term = searchInput.value.toLowerCase();
  let filtered = [];

  if (currentFilter === 'all') filtered = allMovies;
  else if (currentFilter === 'movie') filtered = movies;
  else if (currentFilter === 'tv_show') filtered = tvShows;
  else filtered = favorites.map(id => allMovies.find(m => m.id === id) || {});

  filtered = filtered.filter(m => m.title?.toLowerCase().includes(term));
  const grid = currentFilter === 'all' ? allGrid :
               currentFilter === 'movie' ? movieGrid :
               currentFilter === 'tv_show' ? tvGrid : favoritesGrid;

  renderSection(filtered, grid);
}

function switchFilter(filter) {
  currentFilter = filter;
  filterTabs.forEach(t => t.classList.remove('active'));
  document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
  document.querySelectorAll('section').forEach(s => s.style.display = 'none');
  document.getElementById(
    filter === 'all' ? 'allSection' :
    filter === 'movie' ? 'movieSection' :
    filter === 'tv_show' ? 'tvSection' : 'favoritesSection'
  ).style.display = 'block';
  renderCurrent();
}

async function toggleFavorite(id, btn) {
  const isFav = favorites.includes(id);
  btn.innerHTML = isFav ? 'Heart' : 'Heart';
  btn.classList.toggle('active', !isFav);

  if (isFav) {
    favorites = favorites.filter(f => f !== id);
    await fetch(API + '/favorites', { method: 'DELETE', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ movieId: id, clientId }) });
  } else {
    favorites.push(id);
    await fetch(API + '/favorites', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ movieId: id, clientId }) });
  }
  if (currentFilter === 'favorites') renderCurrent();
}

async function loadFavorites() {
  const res = await fetch(API + '/favorites/' + clientId);
  const data = await res.json();
  favorites = data.ok ? data.movies.map(m => m.id) : [];
}

async function playTrailer(movieId) {
  const res = await fetch(API + '/movies/' + movieId + '/trailer');
  const data = await res.json();
  if (data.ok) {
    trailerIframe.src = data.url;
    trailerModal.classList.add('active');
  } else {
    alert('No trailer found');
  }
}

function closeTrailer() {
  trailerModal.classList.remove('active');
  trailerIframe.src = '';
}

// --- Keep your existing password, player, admin logic below ---
async function loadMovies() {
  const res = await fetch(API + '/movies');
  const data = await res.json();
  if (!data.ok) return;

  allMovies = data.movies;
  movies = allMovies.filter(m => m.type === 'movie');
  tvShows = allMovies.filter(m => m.type === 'tv_show');
  await loadFavorites();
  renderCurrent();
}

function requestMoviePassword(id, title, type) {
  // your existing password modal logic
}

// ... rest of your original JS (admin, player, etc.) ...

document.getElementById('adminBtn').addEventListener('click', openAdminPanel);
searchInput.addEventListener('input', renderCurrent);
filterTabs.forEach(tab => tab.addEventListener('click', () => switchFilter(tab.dataset.filter)));
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeTrailer(); });

loadMovies();
</script>
</body>
</html>
